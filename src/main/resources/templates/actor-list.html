<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>Actor List</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f8f9fa;
        }
        label.error {
            font-size:15px;
            color: red;
            padding: 2px 8px;
            margin-top: 2px;
	 }
    </style>
</head>
<body>
<section class="middle search">
    <div class="container">
        <div class="row justify-content-center">
            <div class="card">
                <div class="card-header">Actor List</div>
                <div class="card-body">
                    <div th:switch="${actors}" class="container my-5">
                        <div class="row">
                            <div class="col">
                                <!-- Button trigger modal -->
                                <!--<a th:href="@{/actor}" class="btn btn-primary btn-sm mb-3"> Add Actor </a>-->
                                <button class="btn btn-primary btn-block mb-3" data-toggle="modal" data-target="#myModal">Add Actor</button>
                            </div>
                            <div class="col">
                                <a th:href="@{/movies}"><button class="btn btn-primary btn-block mb-3">Show Movies</button></a>
                            </div>
                        </div>

                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>Actor ID</th>
                                        <th>Actor Name</th>
                                        <th>Gender</th>
                                        <th>Dob</th>
                                        <th>Phone</th>
                                        <th>Biography</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <h2 th:case="null">No Actors yet!</h2>
                                    <div th:case="*">
                                    <tr th:each="actor : ${actors}">
                                        <td th:text="${actor.id}"></td>
                                        <td th:text="${actor.userName}"></td>
                                        <td th:text="${actor.gender}"></td>
                                        <td th:text="${actor.dateOfBirth}"></td>
                                        <td th:text="${actor.phoneNumber}"></td>
                                        <td th:text="${actor.biography}"></td>
                                        <td>
                                            <a th:href="@{/actor/edit/{id}(id=${actor.id})}">Edit</a>
                                            <a th:href="@{/actor/delete/{id}(id=${actor.id})}" onclick="return confirm('Are you sure you want to delete this Actor?')">Delete</a>
                                        </td>
                                    </tr>
                                    <!-- Additional rows can be added dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.0/additional-methods.js"></script>

<!-- Modal -->
<div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Modal header -->
            <div class="modal-header">
                <h4 class="modal-title">Add Actor</h4>
                <span style="color:red" th:text="${error}"></span>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

                <form th:action="@{/actor/save}" id="registrationForm" th:object="${actor}" method="post" autocomplete="off">


                        <div class="form-group">
                            <label class="control-label" for="userName">User Name</label>
                            <input type="text" class="form-control" id="userName" th:field="*{userName}" placeholder="Enter username">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Gender</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" th:field="*{gender}" name="gender" value="Male" id="genderMale">
                                <label class="form-check-label" for="genderMale">Male</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" th:field="*{gender}" name="gender" id="genderFemale" value="Female" >
                                <label class="form-check-label" for="genderFemale">Female</label>
                            </div>
                            <div id="genderError" class="gender-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="dateOfBirth">Date of Birth</label>
                            <input type="date" class="form-control" id="dateOfBirth" th:field="*{dateOfBirth}" autocomplete="off">
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="phoneNumber">Phone Number</label>
                            <input type="tel" class="form-control" id="phoneNumber" th:field="*{phoneNumber}">
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="biography">biography</label>
                            <textarea class="form-control" id="biography" th:field="*{biography}" rows="3"></textarea>
                        </div>


                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    $.validator.addMethod("minAge", function(value, element, min) {
    var today = new Date();
    var birthDate = new Date(value);
    var age = today.getFullYear() - birthDate.getFullYear();

    if (age > min+1) {
        return true;
    }

    var m = today.getMonth() - birthDate.getMonth();

    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }

    return age >= min;
    },);

    $.validator.addMethod(
    "regex",
    function(value, element, regexp) {
        var check = false;
        var re = new RegExp(regexp);
        return this.optional(element) || re.test(value);
    },
    "Special char not allowed!"
    );

$(document).ready(function() {
$("#registrationForm").validate({
    rules: {
        'userName': {
        required: true,
        minlength: 6,
        maxlength: 20,
        regex: "^[a-zA-Z0-9\s ]+$"
        },

        gender:{
           required: true
        },

        'dateOfBirth': {
        minAge: 18
        },

        'phoneNumber': {
         required: true,
         minlength: 10,
         maxlength: 10
        },

        'biography': {
        maxlength: 50
        }
    },

    messages: {
        userName: {
        required: "Fill Username!",
        maxlength: "Username contains 20 characters!",
        minlength: "Minimum 6 characters required!"
        },

        gender: {
        required: "Select your gender!"
        },

        dateOfBirth: {
        minAge: "age should be 18!"
        },

        biography: {
        maxlength: "Only 50 chars allowed!"
        },

        phoneNumber: {
        required: "Fill Phone Field",
        maxlength: "Only 10 allowed!"
        }
    },

    highlight: function (element) {
        $(element).closest('.control-group').removeClass('success').addClass('error');
    },

    submitHandler: function(form) {
		form.submit();
	}

});
});
</script>
</body>
</html>